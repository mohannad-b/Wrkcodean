You’re my senior full-stack engineer. Fix the “New automation → Builder” UX + the broken copilot draft pipeline.

CONTEXT
- Video shows: (1) transition from “Describe your process” to builder is weak, (2) prompt doesn’t auto-submit in chat after creation, (3) chat feels noisy/unclear what’s progressing, (4) no flowchart generated, (5) copilot_analyses table has no rows.
- Codebase is the latest zip. Don’t ask me questions unless truly blocked. Make reasonable assumptions and ship.

GOALS (in order)
1) Make the “Create automation” handoff feel premium (animation + clear staged progress).
2) Ensure the initial prompt is automatically injected into the builder chat exactly once (no manual resubmit).
3) Simplify chat progress UX so it’s obvious what’s happening (single progress component + optional details).
4) Fix why the flowchart/blueprint isn’t being generated.
5) Ensure copilot_analyses is being written to (or if DB layer is missing/broken, make it obvious via logs + fix the write).

TASKS

A) Fix missing/incorrect draft endpoint (probable 404)
- Search for fetch calls from StudioChat (or equivalent) to a route like:
  /api/automation-versions/[id]/copilot/draft-workflow
- Search for the actual API route folder. In this codebase it appears to be:
  app/api/automation-versions/[id]/copilot/draft-blueprint/route.ts
- Make the route path and client fetch path match.
  Preferred: rename route folder to `draft-workflow` to align with product language.
  Alternative: change client fetch to `draft-blueprint`.
- Add robust error handling: if draft call fails, show a clear error toast/banner and stop progress state.

B) Auto-inject the initial prompt into builder chat exactly once
- On the “new automation” page, after creating the automation/version, route to the builder with the seed prompt:
  /automations/{id}?tab=blueprint&seed={encodeURIComponent(prompt)}
- In the builder client page, read `seed` from searchParams on mount, set `injectedChatMessage = seed`, then immediately remove the seed from the URL (router.replace) so refresh doesn’t re-trigger.
- Ensure StudioChat (or the chat component) sees injectedChatMessage and triggers send once.
- Add a guard (ref) so it never double-sends.

C) Improve “Describe → Creating → Builder” transition
- In new automation page:
  - Add `isCreating` state set to true on submit
  - Show a full-screen transition overlay with motion:
    Step 1: “Creating workflow…”
    Step 2: “Booting Copilot…”
  - Use Framer Motion for smooth fade/scale/blur.
  - Only navigate to builder once creation + seed routing is ready.
- Keep it minimal but high-quality: no jitter, no layout thrash.

D) Make chat progress clear (less noise)
- In StudioChat:
  - Replace multiple simultaneous spinners/messages with ONE progress UI component:
    1) Understanding your process
    2) Drafting workflow
    3) Drawing flowchart
  - Show agent/log details only under a collapsed “Details” expander.
  - Ensure each step flips deterministically based on the async pipeline:
    - step 1 when chat request starts
    - step 2 when draft endpoint is called
    - step 3 when blueprint/flowchart nodes are produced and rendered
- Ensure the user always sees ONE obvious thing happening.

E) Flowchart generation wiring
- Find the blueprint canvas/render code. Confirm what it expects:
  - Does it read nodes/edges from Blueprint.steps or some derived structure?
- After draft workflow completes, ensure the response updates the canonical blueprint state used by the canvas.
- If draft returns steps but the canvas isn’t re-rendering:
  - fix state update wiring (single source of truth, immutable update)
  - verify the inspector/sections stay in sync

F) copilot_analyses persistence
- Find any API routes for copilot chat/analysis, likely:
  app/api/automation-versions/[id]/copilot/chat/route.ts
  app/api/automation-versions/[id]/copilot/analysis/route.ts (or similar)
- Confirm where copilot_analyses is written. If missing:
  - implement an insert/upsert on every chat turn (store: automationVersionId, prompt, response, reasoning summary/metadata, timestamps)
- If DB layer/schema is missing in this archive (e.g., import "@/db/schema" broken):
  - fix the import paths OR add the missing db folder/schema
  - at minimum, add loud server logs + error responses so failures aren’t silent
- Add console.error on failures and return structured JSON errors to the client.

ACCEPTANCE CRITERIA
- New automation: submit → animated overlay → navigates to builder → chat auto-sends seed prompt → progress shows 3 clear steps → blueprint/flowchart appears without manual resubmission.
- No 404s on draft endpoints.
- copilot_analyses has rows after a run OR failures are clearly surfaced (no silent fail).
- Keep changes minimal and consistent with existing architecture.

DELIVERABLES
- Implement the changes and show me:
  - the exact files changed
  - concise notes on what was fixed and why
  - any follow-up TODOs (only if truly necessary)